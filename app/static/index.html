<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PM Decision OS (MVP)</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">PM Decision OS</div>
      <div class="muted">Market facts + decision events (MVP)</div>
    </div>
  </header>

  <main class="layout">
    <!-- Left: Cases -->
    <section class="panel">
      <h2>Cases</h2>

      <form id="createCaseForm" class="stack">
        <label class="field">
          <span>Ticker</span>
          <input id="tickerInput" name="ticker" type="text" placeholder="AAPL" autocomplete="off" required />
        </label>
        <button type="submit">Create Case</button>
        <div id="caseCreateError" class="error" style="display:none;"></div>
      </form>

      <div class="divider"></div>

      <ul id="caseList" class="list"></ul>
    </section>

    <!-- Middle: Timeline -->
    <section class="panel" id="caseDetailSection" style="display:none;">
      <h2>Timeline</h2>
      <div class="muted" id="caseHeader"></div>

      <table class="table" aria-label="Decision events">
        <thead>
          <tr>
            <th style="width: 170px;">Time</th>
            <th style="width: 140px;">Type</th>
            <th>Summary</th>
          </tr>
        </thead>
        <tbody id="eventTableBody"></tbody>
      </table>

      <div id="eventsError" class="error" style="display:none;"></div>
    </section>

    <!-- Right: Add event + Thesis -->
    <section class="panel" id="rightPanel" style="display:none;">
      <h2>New Event</h2>

      <form id="eventForm" class="stack">
        <label class="field">
          <span>Event time</span>
          <input id="eventTsInput" name="event_ts" type="datetime-local" required />
        </label>

        <label class="field">
          <span>Event type</span>
          <select id="eventTypeSelect" name="event_type" required>
            <option value="INITIATE">INITIATE</option>
            <option value="THESIS_UPDATE">THESIS_UPDATE</option>
            <option value="RISK_NOTE">RISK_NOTE</option>
            <option value="RESIZE">RESIZE</option>
          </select>
        </label>

        <!-- INITIATE -->
        <div id="formInitiate" class="formBox">
          <h3>Initiate</h3>

          <div class="grid2">
            <label class="field">
              <span>Direction</span>
              <select id="initDirection" required>
                <option value="LONG">LONG</option>
                <option value="SHORT">SHORT</option>
              </select>
            </label>

            <label class="field">
              <span>Horizon (days)</span>
              <input id="initHorizonDays" type="number" min="1" step="1" value="90" required />
            </label>
          </div>

          <label class="field">
            <span>Entry thesis (1–3 sentences)</span>
            <textarea id="initEntryThesis" rows="3" required></textarea>
          </label>

          <label class="field">
            <span>Key drivers (comma-separated)</span>
            <input id="initKeyDrivers" type="text" placeholder="unit growth, margin expansion, inventory reset"
              required />
          </label>

          <label class="field">
            <span>Key risks (comma-separated)</span>
            <input id="initKeyRisks" type="text" placeholder="promotions, macro slowdown" required />
          </label>

          <label class="field">
            <span>Invalidation triggers (comma-separated)</span>
            <input id="initInvalidationTriggers" type="text" placeholder="txns rolling weekly < -2%, GM -50bp"
              required />
          </label>

          <div class="grid2">
            <label class="field">
              <span>Conviction (0–100)</span>
              <input id="initConviction" type="number" min="0" max="100" step="1" value="65" required />
            </label>

            <label class="field">
              <span>Position intent % (optional)</span>
              <input id="initPositionIntentPct" type="number" step="0.01" placeholder="e.g. 2.0" />
            </label>
          </div>
        </div>

        <!-- THESIS_UPDATE -->
        <div id="formThesisUpdate" class="formBox" style="display:none;">
          <h3>Thesis Update</h3>

          <label class="field">
            <span>What changed</span>
            <select id="tuWhatChanged" required>
              <option value="FUNDAMENTALS">FUNDAMENTALS</option>
              <option value="VALUATION">VALUATION</option>
              <option value="TECHNICALS">TECHNICALS</option>
              <option value="POSITIONING">POSITIONING</option>
              <option value="MACRO">MACRO</option>
              <option value="DATA">DATA</option>
            </select>
          </label>

          <label class="field">
            <span>Update summary</span>
            <textarea id="tuSummary" rows="3" required></textarea>
          </label>

          <div class="grid2">
            <label class="field">
              <span>Drivers add (comma-separated)</span>
              <input id="tuDriversAdd" type="text" />
            </label>
            <label class="field">
              <span>Drivers remove (comma-separated)</span>
              <input id="tuDriversRemove" type="text" />
            </label>
          </div>

          <div class="grid2">
            <label class="field">
              <span>Risks add (comma-separated)</span>
              <input id="tuRisksAdd" type="text" />
            </label>
            <label class="field">
              <span>Risks remove (comma-separated)</span>
              <input id="tuRisksRemove" type="text" />
            </label>
          </div>

          <div class="grid2">
            <label class="field">
              <span>Triggers add (comma-separated)</span>
              <input id="tuTriggersAdd" type="text" />
            </label>
            <label class="field">
              <span>Triggers remove (comma-separated)</span>
              <input id="tuTriggersRemove" type="text" />
            </label>
          </div>

          <div class="grid2">
            <label class="field">
              <span>Conviction delta (-20..+20)</span>
              <input id="tuConvictionDelta" type="number" min="-20" max="20" step="1" value="0" required />
            </label>
            <label class="field">
              <span>Confidence (0..1)</span>
              <input id="tuConfidence" type="number" min="0" max="1" step="0.05" value="0.65" required />
            </label>
          </div>
        </div>

        <!-- RISK_NOTE -->
        <div id="formRiskNote" class="formBox" style="display:none;">
          <h3>Risk Note</h3>

          <div class="grid2">
            <label class="field">
              <span>Risk type</span>
              <select id="rnRiskType" required>
                <option value="DRAWDOWN">DRAWDOWN</option>
                <option value="LIQUIDITY">LIQUIDITY</option>
                <option value="EARNINGS">EARNINGS</option>
                <option value="MACRO">MACRO</option>
                <option value="THESIS_BREAK">THESIS_BREAK</option>
                <option value="POSITIONING">POSITIONING</option>
                <option value="OTHER">OTHER</option>
              </select>
            </label>

            <label class="field">
              <span>Severity</span>
              <select id="rnSeverity" required>
                <option value="LOW">LOW</option>
                <option value="MEDIUM">MEDIUM</option>
                <option value="HIGH">HIGH</option>
              </select>
            </label>
          </div>

          <label class="field">
            <span>Note</span>
            <textarea id="rnNote" rows="3" required></textarea>
          </label>

          <div class="grid2">
            <label class="field">
              <span>Action</span>
              <select id="rnAction" required>
                <option value="MONITOR">MONITOR</option>
                <option value="HEDGE">HEDGE</option>
                <option value="REDUCE">REDUCE</option>
                <option value="EXIT">EXIT</option>
                <option value="NONE">NONE</option>
              </select>
            </label>

            <label class="field">
              <span>Due by (optional)</span>
              <input id="rnDueBy" type="date" />
            </label>
          </div>
        </div>

        <!-- RESIZE -->
        <div id="formResize" class="formBox" style="display:none;">
          <h3>Resize</h3>

          <div class="grid2">
            <label class="field">
              <span>From % (optional)</span>
              <input id="rsFromPct" type="number" step="0.01" placeholder="e.g. 1.0" />
            </label>
            <label class="field">
              <span>To %</span>
              <input id="rsToPct" type="number" step="0.01" placeholder="e.g. 2.0" required />
            </label>
          </div>

          <label class="field">
            <span>Reason</span>
            <select id="rsReason" required>
              <option value="RISK">RISK</option>
              <option value="THESIS">THESIS</option>
              <option value="PRICE">PRICE</option>
              <option value="CONSTRAINTS">CONSTRAINTS</option>
              <option value="LIQUIDITY">LIQUIDITY</option>
              <option value="OTHER">OTHER</option>
            </select>
          </label>

          <label class="field">
            <span>Rationale</span>
            <textarea id="rsRationale" rows="3" required></textarea>
          </label>

          <fieldset class="fieldset">
            <legend>Constraints (optional)</legend>
            <label class="check">
              <input id="rsAdvBinding" type="checkbox" />
              <span>ADV cap binding</span>
            </label>
            <label class="check">
              <input id="rsGrossBinding" type="checkbox" />
              <span>Gross cap binding</span>
            </label>
            <label class="check">
              <input id="rsNetBinding" type="checkbox" />
              <span>Net cap binding</span>
            </label>
          </fieldset>
        </div>

        <label class="field">
          <span>Payload preview</span>
          <textarea id="payloadPreview" rows="10" readonly></textarea>
        </label>

        <button type="submit">Submit Event</button>
        <div id="eventSubmitError" class="error" style="display:none;"></div>
      </form>

      <div class="divider"></div>

      <h2>Thesis Snapshot</h2>
      <form id="compileThesisForm" class="stack">
        <label class="field">
          <span>As-of time</span>
          <input id="thesisAsofInput" type="datetime-local" required />
        </label>
        <button type="submit">Compile Thesis</button>
        <div id="compileError" class="error" style="display:none;"></div>
      </form>

      <div class="snapshot" id="snapshotBox" style="display:none;">
        <div class="muted" id="snapshotMeta"></div>
        <pre id="snapshotJson"></pre>
        <div class="narrative" id="snapshotNarrative"></div>
      </div>
    </section>
  </main>

  <script src="/static/app.js"></script>
</body>

</html>